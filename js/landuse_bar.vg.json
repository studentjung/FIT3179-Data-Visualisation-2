{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "background": "#f8f8f8",
  "data": {
    "url": "data/suburb_landuse.topojson",
    "format": {
      "type": "topojson",
      "feature": "sa2_landuse_summary"
    }
  },
  "params": [
    {
      "name": "order_by",
      "bind": {
        "input": "select",
        "options": [
          null,
          "transport",
          "credited_open_space",
          "uncredited_open_space",
          "developable_area_residential",
          "education_community_government",
          "developable_area_employment",
          "regional_open_space",
          "other_non_developable_land"
        ],
        "labels": [
          "All",
          "Transport",
          "Credited Open Space",
          "Uncredited Open Space",
          "Residential",
          "Education/Community/Government",
          "Industrial/Commercial",
          "Regional Open Space",
          "Non-Developable"
        ],
        "name": "Order By: "
      }
    },
    {
      "name": "order_asc_desc",
      "value": "descending",
      "bind": {
        "input": "select",
        "options": ["ascending", "descending"],
        "labels": ["Ascending", "Descending"],
        "name": "Ascending/Descending: "
      }
    }  
  ],
  "transform": [
    {
      "fold": [
        "properties.transport",
        "properties.credited_open_space",
        "properties.uncredited_open_space",
        "properties.developable_area_residential",
        "properties.education_community_government",
        "properties.developable_area_employment",
        "properties.regional_open_space",
        "properties.other_non_developable_land"
      ],
      "as": ["land_use_type", "area"]
    },
    {
      "calculate": "order_by == null ? datum.area : (datum.land_use_type == ('properties.' + order_by) ? datum.area : 0)",
      "as": "sort_value"
    },
    {
      "filter": "datum.area != null && datum.area > 0.05"
    },
    {
      "calculate": "datum.land_use_type === 'properties.developable_area_residential' ? 'Residential' : datum.land_use_type === 'properties.developable_area_employment' ? 'Employment' : datum.land_use_type === 'properties.uncredited_open_space' ? 'Uncredited Open Space' : datum.land_use_type === 'properties.transport' ? 'Transport' : datum.land_use_type === 'properties.credited_open_space' ? 'Credited Open Space' : datum.land_use_type === 'properties.education_community_government' ? 'Education / Community / Gov' : datum.land_use_type === 'properties.regional_open_space' ? 'Regional Open Space' : datum.land_use_type === 'properties.other_non_developable_land' ? 'Other Non-Developable' : datum.land_use_type",
      "as": "land_use_friendly"
    }
    ,
    {
      "calculate": "order_asc_desc === 'ascending' ? datum.sort_value : -datum.sort_value",
      "as": "sort_key"
    }
  ],
  "title": "Absolute land use per suburb",
  "layer": [
    {
      "mark": "bar",
      "encoding": {
        "y": {
          "field": "properties.sa2_name21",
          "type": "nominal",
          "title": "Suburb",
          "sort": {
            "op": "sum",
            "field": "sort_key",
            "order": "ascending"
          }
        },
        "x": { 
          "aggregate": "sum", 
          "field": "area",
          "type": "quantitative",
          "title": "Selected Land Use (km²)"
        },
        "color": {
          "field": "land_use_friendly",
          "type": "nominal",
          "title": "Land Use Type",
          "scale": {
            "domain": [
              "Residential",
              "Employment",
              "Uncredited Open Space",
              "Transport",
              "Credited Open Space",
              "Education / Community / Gov",
              "Regional Open Space",
              "Other Non-Developable"
            ]
          }
        },
        "tooltip": [
          {"field": "properties.sa2_name21", "type": "nominal", "title": "Suburb"},
          {"field": "properties.areasqkm21", "type": "quantitative", "title": "Suburb Total Area (km²)", "format": ".2f"},
          {"field": "land_use_friendly", "type": "nominal", "title": "Land Use Type"},
          {"field": "area", "type": "quantitative", "title": "Land Use Area (km²)", "format": ".2f"}
        ]
      }
    }
  ]
}