{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "background": "#303030",
  "data": {
    "url": "data/suburb_landuse.topojson",
    "format": {
      "type": "topojson",
      "feature": "sa2_landuse_summary"
    }
  },
  "autosize": {
    "type": "fit"
  },
  "width": "container",
  "height": 500,
  "config": {
    "axis": {
      "labelColor": "white",
      "titleColor": "white",
      "labelFont": "Open Sans",
      "titleFont": "Open Sans",
      "titleFontSize": 14,
      "labelFontSize": 13
    },
    "legend": {
      "labelColor": "white",
      "titleColor": "white",
      "labelFont": "Open Sans",
      "titleFont": "Open Sans",
      "titleFontSize": 14,
      "labelFontSize": 13
    },
    "title": {
      "color": "white",
      "font": "Open Sans",
      "fontSize": 16
    }
  },
  "params": [
    {
      "name": "order_by",
      "bind": {
        "input": "select",
        "options": [
          null,
          "open_space",
          "community",
          "infrastructure",
          "industrial",
          "residential"
        ],
        "labels": [
          "All",
          "Open Space",
          "Community",
          "Infrastructure",
          "Industrial",
          "Residential"
        ],
        "name": "Order By: "
      }
    },
    {
      "name": "order_asc_desc",
      "value": "descending",
      "bind": {
        "input": "select",
        "options": ["ascending", "descending"],
        "labels": ["Ascending", "Descending"],
        "name": "Ascending/Descending: "
      }
    }
  ],
  "transform": [
    {
      "calculate": "(datum.properties.other_non_developable_land + datum.properties.regional_open_space + datum.properties.credited_open_space + datum.properties.uncredited_open_space)",
      "as": "open_space_area"
    },
    {
      "calculate": "datum.properties.education_community_government",
      "as": "community_area"
    },
    {
      "calculate": "datum.properties.transport",
      "as": "infrastructure_area"
    },
    {
      "calculate": "datum.properties.developable_area_employment",
      "as": "industrial_area"
    },
    {
      "calculate": "datum.properties.developable_area_residential",
      "as": "residential_area"
    },
    {
      "fold": [
        "open_space_area",
        "community_area",
        "infrastructure_area",
        "industrial_area",
        "residential_area"
      ],
      "as": ["land_use_type", "area"]
    },
    {
      "calculate": "order_by == null ? datum.area : (datum.land_use_type === (order_by + '_area') ? datum.area : 0)",
      "as": "sort_value"
    },
    {
      "filter": "datum.area != null && datum.area > 0.05"
    },
    {
      "calculate": "datum.land_use_type === 'open_space_area' ? 'Open Space' : datum.land_use_type === 'community_area' ? 'Community' : datum.land_use_type === 'infrastructure_area' ? 'Infrastructure' : datum.land_use_type === 'industrial_area' ? 'Industrial' : 'Residential'",
      "as": "land_use_friendly"
    },
    {
      "calculate": "order_asc_desc === 'ascending' ? datum.sort_value : -datum.sort_value",
      "as": "sort_key"
    }
  ],
  "title": "Absolute land use per suburb",
  "layer": [
    {
      "mark": "bar",
      "encoding": {
        "x": {
          "field": "properties.sa2_name21",
          "type": "nominal",
          "title": "Suburb",
          "axis": { "labelAngle": -45 },
          "sort": {
            "op": "sum",
            "field": "sort_key",
            "order": "ascending"
          }
        },
        "y": {
          "aggregate": "sum",
          "field": "area",
          "type": "quantitative",
          "title": "Selected Land Use (km²)"
        },
        "color": {
          "field": "land_use_friendly",
          "type": "nominal",
          "scale": {
            "domain": [
              "Community",
              "Infrastructure",
              "Industrial",
              "Open Space",
              "Residential"
            ],
            "range": ["#E67F30", "#E65D5D", "#B45BD9", "#45B671", "#4B92DB"]
          },
          "legend": {
            "title": "Land Use Type",
            "orient": "right"
          }
        },
        "tooltip": [
          {
            "field": "properties.sa2_name21",
            "type": "nominal",
            "title": "Suburb"
          },
          {
            "field": "properties.areasqkm21",
            "type": "quantitative",
            "title": "Suburb Total Area (km²)",
            "format": ".2f"
          },
          {
            "field": "land_use_friendly",
            "type": "nominal",
            "title": "Land Use Type"
          },
          {
            "field": "area",
            "type": "quantitative",
            "title": "Land Use Area (km²)",
            "format": ".2f"
          },
          {
            "field": "all_total",
            "type": "quantitative",
            "title": "Total Land Use Area (km²)",
            "format": ".2f"
          }
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "bottom",
        "color": "white",
        "fontSize": 16,
        "font": "Open Sans"
      },
      "encoding": {
        "text": { "value": "Rockbank - Mount Cottrell has 40.56 km² of" },
        "x": { "value": 440 },
        "y": { "value": 85 }
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "bottom",
        "color": "white",
        "fontSize": 16,
        "font": "Open Sans"
      },
      "encoding": {
        "text": { "value": "planned out space making it the largest." },
        "x": { "value": 445 },
        "y": { "value": 100 }
      }
    }
  ]
}
